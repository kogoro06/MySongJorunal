<div class="min-h-screen bg-customred flex flex-col items-center justify-center relative">
  <div class="bg-white p-4 rounded shadow-md w-full max-w-lg relative">
    <%= form_with(model: @journal, local: true, id: "journal-form", class: "w-full space-y-6") do |form| %>

      <!-- タイトル入力 -->
      <div class="form-control">
        <%= form.label :title, "タイトル", class: "label text-sm" %>
        <div id="title-container" class="w-3/4 mx-auto">
          <!-- 表示状態 -->
          <div id="title-display" class="hidden flex flex-col items-center justify-center">
            <span id="title-text" class="text-xl font-bold text-center block">
              <%= @journal.title.presence || "タイトル未設定" %>
            </span>
            <button type="button" id="edit-title-btn" class="btn btn-outline btn-xs mt-2">
              編集
            </button>
          </div>
          <!-- 編集状態 -->
          <div id="title-edit" class="<%= @journal.title.present? ? 'hidden' : '' %>">
            <%= form.text_field :title, required: true, placeholder: "タイトルを入力", class: "input input-bordered w-full text-sm" %>
            <button type="button" id="confirm-title-btn" class="btn btn-primary btn-xs mt-2 w-full">
              確定
            </button>
          </div>
        </div>
      </div>

      <!-- 日付表示 -->
      <div class="form-control text-right">
        <span class="text-xs text-gray-500"><%= Time.current.strftime('%Y年%m月%d日') %></span>
      </div>

      <!-- メモ入力 -->
      <div class="form-control">
        <%= form.label :content, "一言メモ", class: "label text-sm" %>
        <%= form.text_area :content, required: true, placeholder: "今日の出来事や気持ちを記入", class: "textarea textarea-bordered text-sm" %>
      </div>

      <!-- 感情入力 -->
      <div class="form-control">
        <%= form.label :emotion, "感情", class: "label text-sm" %>
        <%= form.select :emotion, options_for_select([["喜", 0], ["怒", 1], ["哀", 2], ["楽", 3]], @journal.emotion), { prompt: "選択してください" }, class: "select select-bordered text-sm" %>
      </div>

      <!-- 曲情報入力 -->
      <div class="form-control">
        <%= form.label :artist_name, "アーティスト名", class: "label text-sm" %>
        <%= form.text_field :artist_name, required: true, placeholder: "アーティスト名を入力", class: "input input-bordered text-sm" %>
      </div>

      <div class="form-control">
        <%= form.label :song_name, "曲名", class: "label text-sm" %>
        <%= form.text_field :song_name, required: true, placeholder: "曲名を入力", class: "input input-bordered text-sm" %>
      </div>

      <!-- 保存ボタン -->
      <div class="form-control">
        <%= form.submit "日記を保存", class: "btn btn-primary text-sm w-full" %>
      </div>

    <% end %>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const titleDisplay = document.getElementById("title-display");
  const titleEdit = document.getElementById("title-edit");
  const editTitleBtn = document.getElementById("edit-title-btn");
  const confirmTitleBtn = document.getElementById("confirm-title-btn");
  const titleInput = document.querySelector("input[name='journal[title]']");
  const titleText = document.getElementById("title-text");

  if (!titleDisplay || !titleEdit || !editTitleBtn || !confirmTitleBtn || !titleInput || !titleText) {
    console.error("Some DOM elements are not found");
    return; // DOM要素が見つからない場合は終了
  }

  // 確定ボタンを押したとき
  confirmTitleBtn.addEventListener("click", () => {
    if (titleInput.value.trim() !== "") {
      titleText.textContent = titleInput.value;
      titleDisplay.classList.remove("hidden");
      titleEdit.classList.add("hidden");
    } else {
      alert("タイトルを入力してください！");
    }
  });

  // 編集ボタンを押したとき
  editTitleBtn.addEventListener("click", () => {
    titleDisplay.classList.add("hidden");
    titleEdit.classList.remove("hidden");
  });
});
</script>
