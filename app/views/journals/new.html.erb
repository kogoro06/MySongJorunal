<div class="min-h-screen bg-customred text-white flex items-center justify-center py-10">
  <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-2xl space-y-6">
    <%= form_with(model: @journal, local: true, id: "journal-form", class: "space-y-6") do |form| %>
      
      <!-- 日付表示 -->
      <div class="text-center mb-4">
        <span class="text-xl font-semibold text-gray-700"><%= Time.current.strftime('%Y年%m月%d日') %></span>
      </div>

      <!-- タイトル入力 -->
      <div>
        <%= form.label :title, "日記タイトル", class: "block text-md font-medium text-gray-700 mb-2" %>
        <%= form.text_field :title, required: true, placeholder: "タイトルを入力", class: "input input-bordered w-full px-4 py-2" %>
      </div>

      <!-- 曲情報（選択後のみ表示） -->
      <% if @journal.song_name.present? || @journal.artist_name.present? || @journal.album_image.present? %>
        <div class="bg-gray-50 p-4 rounded-md shadow-inner mt-6">
          <h2 class="text-lg font-semibold text-gray-800 mb-2">選択した曲情報</h2>

          <% if @journal.song_name.present? %>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">曲名</label>
              <span id="selected-song-name" class="block text-md font-bold text-gray-800">
                <%= @journal.song_name %>
              </span>
            </div>
          <% end %>

          <% if @journal.artist_name.present? %>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700">アーティスト名</label>
              <span id="selected-artist-name" class="block text-md font-bold text-gray-800">
                <%= @journal.artist_name %>
              </span>
            </div>
          <% end %>

          <% if @journal.album_image.present? %>
            <div class="mb-4 text-center">
              <img id="selected-album-image" src="<%= @journal.album_image %>" alt="アルバム画像" class="w-64 h-64 object-cover mx-auto rounded-lg shadow-md">
            </div>
          <% end %>

          <% if @journal.preview_url.present? %>
            <div class="text-center">
              <audio id="selected-audio" controls class="w-full">
                <source src="<%= @journal.preview_url %>" type="audio/mpeg">
                お使いのブラウザは音声プレビューをサポートしていません。
              </audio>
            </div>
          <% end %>
        </div>
      <% end %>

      <!-- モーダルボタン -->
      <div class="flex gap-4 mt-6">
        <button type="button" id="open-search-modal" class="btn btn-secondary w-full">
          曲を選ぶ
        </button>
        <button type="button" id="reopen-search-modal" class="btn btn-secondary w-1/2 hidden">
          曲を選びなおす
        </button>
      </div>

      <!-- 隠しフィールドで曲情報を送信 -->
      <%= form.hidden_field :song_name, value: @journal.song_name %>
      <%= form.hidden_field :artist_name, value: @journal.artist_name %>
      <%= form.hidden_field :album_image, value: @journal.album_image %>
      <%= form.hidden_field :preview_url, value: @journal.preview_url %>

      <!-- メモ入力 -->
      <div>
        <%= form.label :content, "一言メモ", class: "block text-md font-medium text-gray-700 mb-2" %>
        <%= form.text_area :content, required: true, placeholder: "今日の出来事や気持ちを記入", class: "textarea textarea-bordered w-full px-4 py-2" %>
      </div>

      <!-- 感情入力 -->
      <div>
        <%= form.label :emotion, "感情", class: "block text-md font-medium text-gray-700 mb-2" %>
        <%= form.select :emotion, options_for_select([["喜", 0], ["怒", 1], ["哀", 2], ["楽", 3]], @journal.emotion), { prompt: "選択してください" }, class: "select select-bordered w-full px-4 py-2" %>
      </div>

      <!-- 保存ボタン -->
      <div class="text-center mt-6">
        <%= form.submit "日記を保存", class: "btn btn-primary w-full py-2 text-lg" %>
      </div>
    <% end %>
  </div>
</div>

<%= render 'shared/spotify_modal' %>
