<!-- 📖 日記フォーム -->
<div class="min-h-screen bg-customred text-white flex items-center justify-center py-10">
  <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-2xl space-y-6">
    <!-- form_with の local を true に設定 -->
    <%= form_with(model: @journal, local: true, id: "journal-form", class: "space-y-6") do |form| %>
      
      <!-- 📅 日付表示 -->
      <div class="text-center mb-4">
        <span class="text-xl font-semibold text-gray-700">
          <%= Time.now.strftime('%Y年%m月%d日') %>
        </span>
      </div>

      <!-- 📝 タイトル入力 -->
      <div>
        <%= form.label :title, "日記タイトル", class: "block text-xl font-medium text-gray-700 mb-2" %>
        <%= form.text_field :title, required: true, placeholder: "タイトルを入力", name: "journal[title]", class: "w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400",id: "journal-title" %>
      </div>

      <!-- 🎼 曲情報 -->
      <div class="bg-gray-100 p-4 text-center mt-6 rounded-lg shadow-inner">
        <div class="text-xl font-bold text-gray-800 mb-4 flex items-center justify-center gap-2">
          <%= image_tag 'spotify.png', alt: 'Spotify Logo', class: 'inline h-6 w-6' %>
          Spotify曲検索
        </div>

        <% if @journal.song_name.present? || @journal.artist_name.present? || @journal.album_image.present? %>
          <% if @journal.artist_name.present? %>
            <div class="mb-2">
              <span id="selected-artist-name" class="block text-lg font-medium text-gray-800">
                🎤 アーティスト: <%= @journal.artist_name %>
              </span>
            </div>
          <% end %>
          <% if @journal.song_name.present? %>
            <div class="mb-2">
              <span id="selected-song-name" class="block text-lg font-medium text-gray-800">
                🎵 曲名: <%= @journal.song_name %>
              </span>
            </div>
          <% end %>
          <% if @journal.album_image.present? %>
            <div class="mb-4">
              <a href="https://open.spotify.com/track/<%= @journal.spotify_track_id %>" target="_blank">
                <img id="selected-album-image" src="<%= @journal.album_image %>" 
                     alt="アルバム画像" 
                     class="w-64 h-64 object-cover mx-auto rounded-lg shadow-md">
              </a>
            </div>
          <% end %>
        <% else %>
          <p class="text-gray-500">まずは曲を選んでください♫</p>
        <% end %>

        <!-- 🎯 モーダルを開くボタン -->
        <div class="flex gap-4 mt-6">
          <button type="button" id="open-search-modal" class="w-full px-4 py-2 bg-green-500 text-white font-medium rounded-md hover:bg-green-600 transition">
            <% if @journal.song_name.present? %>
              曲を選び直す♫
            <% else %>
              曲を選ぶ♫
            <% end %>
          </button>
        </div>
      </div>

      <!-- 🎼 隠しフィールドで曲情報を送信 -->
      <%= form.hidden_field :song_name, value: @journal.song_name, name: "journal[song_name]" %>
      <%= form.hidden_field :artist_name, value: @journal.artist_name, name: "journal[artist_name]" %>
      <%= form.hidden_field :album_image, value: @journal.album_image, name: "journal[album_image]" %>
      <%= form.hidden_field :preview_url, value: @journal.preview_url, name: "journal[preview_url]" %>
      <%= form.hidden_field :spotify_track_id, value: @journal.spotify_track_id, name: "journal[spotify_track_id]" %>

      <!-- 😊 感情入力 -->
      <div>
        <%= form.label :emotion, "感情", class: "block text-md font-medium text-gray-700 mb-2" %>
        <%= form.select :emotion, 
            options_for_select([["喜", "喜"], ["怒", "怒"], ["哀", "哀"], ["楽", "楽"]], @journal.emotion), 
            { prompt: "選択してください" }, 
            name: "journal[emotion]", 
            class: "w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400",
            id: "journal-emotion" %>
      </div>

      <!-- 📝 メモ入力 -->
      <div>
        <%= form.label :content, "本文", class: "block text-md font-medium text-gray-700 mb-2" %>
        <%= form.text_area :content, required: true, placeholder: "今日の出来事や気持ちを記入", name: "journal[content]", class: "w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400",id: "journal-content" %>
      </div>

      <!-- 💾 保存ボタン -->
      <div class="text-center mt-6">
        <%= form.submit "📥 日記を保存", class: "w-full px-4 py-2 bg-blue-500 text-white font-medium rounded-md hover:bg-blue-600 transition text-lg" %>
      </div>
    <% end %>
  </div>
</div>

<%= render 'shared/spotify_modal' %>
